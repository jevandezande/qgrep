#!/usr/bin/env python3

# Script that takes an output file and gets the last energy of specified type
# Energy in eV currently

import argparse
from cclib import ccopen
import os, sys
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from qgrep.helper import convert_energy


parser = argparse.ArgumentParser(description='Get the energy from output file.')
parser.add_argument('-i', '--input', help='The file to be read.', type=str,
                    default='output.dat')
parser.add_argument('-t', '--energy_type', help='Output the specified energy.',
                    type=str, default='scf')
parser.add_argument('-u', '--units', help='Units to output energy in.',
                    type=str, default='hartree')

args = parser.parse_args()

data = ccopen(args.input).parse()

if args.energy_type == 'gibbs':
    energies = data.freeenergy
else:
    try:
        energies = getattr(data, args.energy_type + 'energies')
    except AttributeError as e:
        raise Exception("Invalid energy type, perhaps it hasn't been run?")

print(convert_energy(energies[-1], 'eV', 'hartree'))
